/*! backbone-nestify 0.1.0 2013-10-30 */
!function(a){"object"==typeof module?module.exports=a(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],a):this.nestify=a(this._,this.Backbone)}(function(a,b){var c=function(a){return null!=a},d={coll:"at"},e=function(c,d){return a.reduce(c,function(c,d){var e;return c&&(e=a.isNumber(d)?c instanceof b.Collection?c.at(d):c[d]:c instanceof b.Model?c.attributes[d]:c[d]),e},d)},f=function(b){return a.map(b,function(b){var c=parseInt(b,10);return a.isNaN(c)?b:c})},g=function(b){return a.isString(b)&&/\|/.exec(b)?f(b.split("|")):b},h=function(b,c){var d;return a.isObject(b)&&!a.isArray(b)?d=b:(a.isArray(b)||a.isString(b))&&(b=a.isArray(b)?b:[b],d=a.reduceRight(b,function(b,c){var d;return d=a.isNumber(c)?[]:{},d[c]=b,d},c)),d},i=function(b){a.isArray(b)||console.log("**WARNING**! expected array but found: "+JSON.stringify(b))},j=function(b,c,d){i(c);var e=b.model;b.reset(a.map(c,function(a){return new e(a,d)}),d)},k=function(b,c,d){i(c);var e=b.model;b.set(a.map(c,function(a){return new e(a,d)}),d)},l=function(b,c,d){i(c);var e=b.model,f=a.zip(b.models,c);a.each(f,function(c,f){var g=a.first(c),h=a.last(c);h&&(g?g.set(h,d):(g=new e(h,d),b.models[f]=g))})},m=function(d,e,f){return f=f||{},e=a.reduce(e,function(e,g,h){var i=g;if(g instanceof b.Model||g instanceof b.Collection||f.unset&&!c(g));else{var m=this.attributes&&this.attributes[h],n=d[h];if(n){var o=m||new n.constructor(n.args);if(o.reset)if(m)switch(f.coll){case"reset":j(o,g,f);break;case"set":k(o,g,f);break;case"at":default:l(o,g,f)}else j(o,g,f);else o.set(g,f);i=o}else m&&(a.isArray(m)?i=a.map(a.zip(g,m),a.compose(a.first,a.compact)):a.isObject(m)&&(i=a.extend({},m,g)))}return e[h]=i,e},{},this)},n=function(c){var f=c||{},i=a.partial(m,f);return{get:function(c){return c=g(c),a.isArray(c)?e(c,this):b.Model.prototype.get.apply(this,arguments)},set:function(c,e,f){c=g(c);var j;return a.isArray(c)?j=h(c,e):a.isObject(c)?(j=c instanceof b.Model?c.attributes:c,f=e):j=h(c,e),!a.isObject(j)||f instanceof b.Model||(f=a.extend({},d,f),j=i.call(this,j,f)),b.Model.prototype.set.call(this,j,f)}}};return n.pathToObject=h,n});